- defaultTab: nodes
  description: |-
    Query CloudWatch logs to identify the top 10 public-IP requestors to our web-server (e.g. Nginx).

    The Job uses the CloudWatch Logs plugin to send a query using the Logs Insights syntax.

    Click on **Definition** on the right to see the specific query used for this Job.

    Click [here](https://docs.rundeck.com/docs/manual/workflow-steps/aws-cloudwatch.html) for more details on the CloudWatch Logs plugin.
    For authenticating AWS plugins, follow the **Configure AWS Credentials** Tour.
  executionEnabled: true
  group: AWS/VPC
  id: 85409f77-a9d7-43f6-9f1d-2ac9bf2f93c6
  loglevel: INFO
  name: Top 10 Web-Server Requestors by Public IP
  nodeFilterEditable: false
  options:
  - description: The CloudWatch log group where the VPC logs reside
    label: CloudWatch Log Group
    name: cloudwatch-log-group
    required: true
  - enforced: true
    label: region
    name: region
    optionValuesPluginType: aws-regions-job-options
    required: true
  plugins:
    ExecutionLifecycle: {}
  scheduleEnabled: true
  schedules: []
  sequence:
    commands:
    - configuration:
        '0': '1'
        cloudWatchLogGroup: ${option.cloudwatch-log-group}
        queryString: |-
          fields @timestamp, @message
            | parse @message /(?<@ip>^([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})[.]*)/
            | stats count() as requestCount by @ip
            | filter @ip not like /(^172\.31\.[.]*)/
            | sort requestCount desc
        region: ${option.region}
        timeUnit: Days
      description: Query web-server logs in CloudWatch for top requestors by Public
        IP address
      nodeStep: false
      type: aws-query-cloudwatch-logs-step
    keepgoing: false
    strategy: node-first
  tags: 'aws,vpc'
  uuid: 85409f77-a9d7-43f6-9f1d-2ac9bf2f93c6

