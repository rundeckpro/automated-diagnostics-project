- defaultTab: nodes
  description: |-
    Retrieve EC2 Instance Status and Associated IAM Roles

    This Job uses the AWS CLI to retrieve the targeted EC2 instance status as well as the associated IAM Roles. This can be useful when diagnosing and troubleshooting EC2 related alarms and incidents.

    The EC2 is targeted using the EC2 `instanceId`. Therefore, integrations invoking this Job should supply the EC2 Instance ID as a Job Option in their payload.

    This Job does **not** require the EC2 to be added as a Node.
  executionEnabled: true
  group: AWS/EC2
  id: a2992d07-a8af-4127-8dfb-035f0d9bece9
  loglevel: INFO
  name: Instance Status & Associated IAM Roles
  nodeFilterEditable: false
  options:
  - label: EC2 Instance ID
    name: instanceId
    required: true
    value: i-073260304484b4449
  plugins:
    ExecutionLifecycle: {}
  scheduleEnabled: true
  schedules: []
  sequence:
    commands:
    - description: Get EC2 Instance Status from AWS
      exec: aws ec2 describe-instance-status --instance-ids ${option.instanceId}
      plugins:
        LogFilter:
        - config:
            filter: .InstanceStatuses[].InstanceStatus.Details[].Status
            logData: 'true'
            prefix: Instance-Status
          type: json-mapper
        - config:
            filter: .InstanceStatuses[].SystemStatus.Details[].Status
            logData: 'true'
            prefix: System-Status
          type: json-mapper
    - description: Get IAM Role Associated
      exec: 'aws ec2 describe-iam-instance-profile-associations --filters Name=instance-id,Values=${option.instanceId}'
      plugins:
        LogFilter:
        - config:
            filter: .IamInstanceProfileAssociations[].IamInstanceProfile
            logData: 'true'
            prefix: IAM_Role
          type: json-mapper
    keepgoing: false
    strategy: node-first
  tags: 'aws,ec2'
  uuid: a2992d07-a8af-4127-8dfb-035f0d9bece9

