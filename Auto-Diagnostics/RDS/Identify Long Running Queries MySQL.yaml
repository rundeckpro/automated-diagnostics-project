- defaultTab: nodes
  description: ''
  executionEnabled: true
  group: Auto-Diagnostics/RDS
  id: b5c27622-3b1f-4842-b652-8cfcce39175d
  loglevel: INFO
  name: Identify Long Running Queries MySQL
  nodeFilterEditable: false
  options:
  - description: How many minutes prior to now should we retrieve logs?
    label: Prior Minutes to Retrieve Logs
    name: prior_minutes
    regex: (\d+)
    required: true
    value: '5'
  plugins:
    ExecutionLifecycle: {}
  scheduleEnabled: true
  schedules: []
  sequence:
    commands:
    - description: Transform Job Option into Timestamp for AWS CLI Query
      fileExtension: sh
      interpreterArgsQuoted: false
      plugins:
        LogFilter:
        - config:
            invalidKeyPattern: \s|\$|\{|\}|\\
            logData: 'true'
            name: retrieval_timestamp
            regex: retrieval_timestamp=(\d+)
          type: key-value-data
      script: |-
        now=$(date +%s%N | cut -b1-13)

        minutes_ago=$((@option.prior_minutes@*60000))

        retrieval_timestamp=$(expr $now - $minutes_ago)

        echo "retrieval_timestamp="$retrieval_timestamp
      scriptInterpreter: /bin/bash
    - description: Retrieve List of Log Files for DB Instance within Timeframe Specified
        by Job Option
      exec: aws rds describe-db-log-files --filename-contains "slowquery" --db-instance-identifier
        "jakesrundeckha" --file-last-written ${data.retrieval_timestamp} --query "DescribeDBLogFiles[].LogFileName"
        --output text
      plugins:
        LogFilter:
        - config:
            hideOutput: 'true'
            logData: 'true'
            name: matching_log_files
            regex: (.*)
          type: key-value-data-multilines
    keepgoing: false
    strategy: node-first
  uuid: b5c27622-3b1f-4842-b652-8cfcce39175d

